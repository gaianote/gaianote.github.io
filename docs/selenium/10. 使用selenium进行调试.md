## 1. 使用远程调试端口进行调试

### 设置 Chrome 的远程调试端口

对于 chrome ,开始和在使用 remote-debugging-port 过程中,都只能打开一个浏览器实例,开启多个就会报错;
所以,使用之前我们需要关闭所有浏览器窗口,在执行调用

**mac**

```bash
pkill -a -i "Google Chrome"
/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --remote-debugging-port=9222
```

**Windows**

右键点击 Chrome 的快捷方式图标，选择属性
在目标一栏，最后加上--remote-debugging-port=9222 注意要用空格隔开

**Linux**

打开控制台执行：

```
google-chrome --remote-debugging-port=9222
```

### 使用 selenium 连接

```python
from selenium import webdriver
def init_driver():
    options = webdriver.ChromeOptions()
    options.add_argument("--disable-blink-features=AutomationControlled")
    options.debugger_address = "127.0.0.1:9222"
    driver = webdriver.Chrome(options=options,)
    return driver

```

## 2. 使用 session_id 进行调试

初始连接

```python
driver = webdriver.Chrome()
executor_url = driver.command_executor._url
session_id = driver.session_id
print(session_id)
print(executor_url)
driver.get("https://www.baidu.com")
```

重连运行

```python
from selenium.webdriver import Remote

class ReuseChrome(Remote):

    def __init__(self, command_executor, session_id):
        self.r_session_id = session_id
        Remote.__init__(self, command_executor=command_executor, desired_capabilities={})

    def start_session(self, capabilities, browser_profile=None):
        """
        重写start_session方法
        """
        if not isinstance(capabilities, dict):
            raise InvalidArgumentException("Capabilities must be a dictionary")
        if browser_profile:
            if "moz:firefoxOptions" in capabilities:
                capabilities["moz:firefoxOptions"]["profile"] = browser_profile.encoded
            else:
                capabilities.update({'firefox_profile': browser_profile.encoded})

        self.capabilities = options.Options().to_capabilities()
        self.session_id = self.r_session_id
        self.w3c = False
def connect_driver(executor_url,session_id):
    """
    重新连接已经打开的浏览器实例
    """
    driver = ReuseChrome(command_executor=executor_url, session_id=session_id)
    return driver
```
