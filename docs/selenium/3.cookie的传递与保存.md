# cookie 的传递与保存

## webdriver 中常用的 cookie 方法

webdriver 中提供了操作 cookie 的相关方法：

- `get_cookies()` 获得 cookie 信息
- `add_cookie(cookie_dict)` 添加 cookie
- `delete_cookie(name)` 删除特定(部分)的 cookie
- `delete_all_cookies()` 删除所有的 cookie

`get_cookies()`返回的是形如下面内容的一个列表

```json
[
  {
    "domain": ".weidian.com",
    "expiry": 1631713416,
    "httpOnly": False,
    "name": "uid",
    "path": "/",
    "secure": False,
    "value": "320474174"
  }
]
```

> 需要注意的是,cookies 的所有操作都是在特定域名下才能生效的,也就是我们要设置 baidu.com 域的 cookie,则需要首先访问 baidu.com,然后才能进行 cookie 的读写操作

## 从浏览器中获取 cookie 实现登陆

在 chrome 的 console 中执行 `document.cookie`获得 cookie,传入 selenium 从而实现登陆

```python
def login_from_cookie_string(driver,url, cookie_string):
    """
    通过 cookie_string 设置 cookie,从而恢复登陆状态
    @param
        url : 要登陆的域名
        cookie_string : chrome console 执行 document.cookie 获得的字符串
    """
    # 必须先访问域名才能设置cookie
    driver.get(url)
    for cookie in cookie_string.split(";"):
        name, value = cookie.split("=")
        driver.add_cookie({"name": name.strip(), "value": value.strip()})
```

## 将 cookie 保存到文本文件中

```python
def save_cookies_to_file(driver,filename):
    cookies = driver.get_cookies()
    with open(f"cookies/{filename}.json","w+",encoding="utf-8") as f:
        f.write(json.dumps(cookies))
```

## 从文本文件中读取 cookie 实现登陆

```python
def login_from_cookie_file(driver,filename):
    time.sleep(5)
    with open(f"cookies/{filename}.json","r",encoding="utf-8") as f:
        cookies = json.loads(f.read())
    for cookie in cookies:
        driver.add_cookie(cookie)
    driver.refresh()
```
